<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Unibet × Polymarket Arb Calculator</title>
  <meta name="description" content="Calculate risk-free arbitrage between a sportsbook YES bet (decimal odds) and a Polymarket NO position, including fees and size to equalize outcomes." />
  <style>
    :root {
      --bg: #0b0e13;
      --card: #121826;
      --muted: #8aa0b2;
      --text: #e6edf3;
      --accent: #4cc38a;
      --danger: #f2555a;
      --warn: #f5a524;
      --border: #223146;
      --shadow: 0 6px 24px rgba(0,0,0,.35), 0 2px 8px rgba(0,0,0,.2);
      --radius: 16px;
      --gap: 14px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
      background: radial-gradient(1200px 800px at 20% -20%, #162235 0%, transparent 60%),
                  radial-gradient(1000px 600px at 110% 0%, #0d1b2a 0%, transparent 60%),
                  var(--bg);
      color: var(--text);
      line-height: 1.35;
    }
    .container { max-width: 1100px; margin: 32px auto; padding: 0 16px; }
    header { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 18px; }
    h1 { font-size: 22px; margin: 0; letter-spacing: 0.2px; }
    .small { color: var(--muted); font-size: 13px; }

    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: var(--gap); }
    .card { grid-column: span 12; background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent 60%), var(--card); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); }
    .card .inner { padding: 18px; }

    @media (min-width: 900px) {
      .card.inputs { grid-column: span 7; }
      .card.results { grid-column: span 5; }
    }

    label { display: block; font-size: 13px; color: var(--muted); margin-bottom: 6px; }
    input[type="text"], input[type="number"], select {
      width: 100%; background: #0f1724; color: var(--text);
      border: 1px solid var(--border); border-radius: 12px; padding: 12px 12px; outline: none;
    }
    input::placeholder { color: #6e8193; }
    .row { display: grid; grid-template-columns: 1fr; gap: var(--gap); }
    @media (min-width: 700px) { .row.two { grid-template-columns: 1fr 1fr; } }
    @media (min-width: 900px) { .row.three { grid-template-columns: 1fr 1fr 1fr; } }

    .inline {
      display: grid; grid-template-columns: 2fr 1fr; gap: 10px;
    }

    .note { font-size: 12px; color: var(--muted); margin-top: 6px; }

    .btns { display: flex; gap: 10px; flex-wrap: wrap; }
    button {
      background: #0f1724; color: var(--text); border: 1px solid var(--border);
      border-radius: 12px; padding: 10px 14px; cursor: pointer; transition: transform .02s ease-in-out, border-color .15s;
    }
    button:hover { border-color: #38567a; }
    button:active { transform: translateY(1px); }
    .btn-primary { background: linear-gradient(180deg, rgba(76,195,138,.18), rgba(76,195,138,.06)); border-color: #2a7f5c; }
    .btn-ghost { background: transparent; }

    .pill { display: inline-flex; align-items:center; gap:6px; padding: 6px 10px; border-radius: 999px; border:1px solid var(--border); background: #0f1724; font-size: 12px; color: var(--muted); }
    .pill.good { color: #b7f6d5; border-color: #2a7f5c; background: rgba(76,195,138,.08); }
    .pill.bad { color: #ffd7d9; border-color: #7a2a2a; background: rgba(242,85,90,.08); }

    .stat {
      background: #0f1724; border:1px solid var(--border); border-radius: 12px; padding: 12px; display: grid; gap:8px;
    }
    .stat .k { font-size: 12px; color: var(--muted); }
    .stat .v { font-size: 18px; font-weight: 600; }

    .results-grid { display: grid; grid-template-columns: 1fr; gap: var(--gap); }
    @media (min-width: 700px) { .results-grid { grid-template-columns: 1fr 1fr; } }

    details { border-top: 1px dashed var(--border); padding-top: 12px; margin-top: 12px; }
    summary { cursor: pointer; color: var(--muted); }
    code { background: #0f1724; border:1px solid var(--border); padding:2px 6px; border-radius: 6px; }

    .footer { margin-top: 16px; color: var(--muted); font-size: 12px; }
    a { color: #8dd9ff; text-decoration: none; }

    .help { font-size: 12px; color: var(--muted); }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Unibet × Polymarket Arb Calculator</h1>
      <div class="small">YES at Sportsbook + NO on Polymarket (includes Polymarket fee)</div>
    </header>

    <div class="grid">
      <section class="card inputs">
        <div class="inner">
          <div class="row two">
            <div>
              <label>Team (optional)</label>
              <input id="team" type="text" placeholder="Bills / Ravens / etc" />
            </div>
            <div>
              <label>Currency symbol</label>
              <input id="ccy" type="text" value="€" maxlength="3" />
            </div>
          </div>

          <div class="row two" style="margin-top:10px;">
            <div>
              <label>Unibet odds (accepts decimal, +American, or fractional)</label>
              <input id="odds" type="text" placeholder="8.0 or +700 or 7/1" />
              <div class="note">Tip: Unibet FR uses decimal (e.g., <code>8.0</code>).</div>
            </div>
            <div>
              <label>Stake at sportsbook</label>
              <div class="inline">
                <input id="stake" type="number" step="0.01" value="100" />
                <select id="stakeUnit">
                  <option value="abs" selected>Absolute</option>
                  <option value="bankroll">% of bankroll</option>
                </select>
              </div>
              <div class="note">If "% of bankroll" is chosen, set bankroll below.</div>
            </div>
          </div>

          <div class="row two" style="margin-top:10px;">
            <div>
              <label>Polymarket NO price (per $1 share)</label>
              <div class="inline">
                <input id="pmPrice" type="text" placeholder="0.87 or 87%" />
                <select id="pmUnit">
                  <option value="dollar" selected>$ per share (0–1)</option>
                  <option value="percent">percent (0–100)</option>
                </select>
              </div>
              <div class="note">This is the price to <b>buy NO</b>. If you only know the YES price p, use q = 1 − p.</div>
            </div>
            <div>
              <label>Polymarket fee</label>
              <div class="inline">
                <input id="fee" type="text" value="2%" />
                <select id="feeUnit">
                  <option value="percent" selected>%</option>
                  <option value="decimal">decimal</option>
                </select>
              </div>
              <div class="note">Default is 2% of <b>net winnings</b> on Polymarket.</div>
            </div>
          </div>

          <div class="row two" style="margin-top:10px;">
            <div>
              <label>Optional: Bankroll (for % stake)</label>
              <input id="bankroll" type="number" step="0.01" placeholder="e.g., 5000" />
            </div>
            <div>
              <label>Rounding</label>
              <select id="rounding">
                <option value="none">None (full precision)</option>
                <option value="cent">Round spends to cents</option>
                <option value="share">Round NO shares to 0.01</option>
              </select>
            </div>
          </div>

          <div class="btns" style="margin-top:14px;">
            <button class="btn-primary" id="calcBtn">Calculate</button>
            <button class="btn-ghost" id="resetBtn">Reset</button>
            <button class="btn-ghost" id="shareBtn">Share pre-filled link</button>
          </div>

          <details style="margin-top:10px;">
            <summary>How this works (math)</summary>
            <div class="help" style="margin-top:8px;">
              You back <b>YES</b> at the sportsbook (stake S at decimal odds D) and <b>buy NO</b> on Polymarket at price q per $1 share. Polymarket charges a fee f on <i>net winnings</i> only.
              <ul>
                <li>Outcome A (team wins): profit = S·(D−1) − K·q</li>
                <li>Outcome B (team loses): profit = −S + K·(1−q)·(1−f)</li>
                <li>Size NO shares to equalize outcomes: <code>K = S·D / (1 − f + f·q)</code></li>
                <li>Minimum D for a risk‑free arb: <code>D<sub>min</sub> = (1 − f + f·q) / ((1 − q)·(1 − f))</code></li>
              </ul>
              If you only have YES price p, use q ≈ 1 − p.
            </div>
          </details>
        </div>
      </section>

      <section class="card results">
        <div class="inner">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px;">
            <div>
              <div class="small">Arb status</div>
              <div id="arbPill" class="pill">
                <div><span class="k">Total bet (Unibet):</span> <span class="v" id="pillUniBet">–</span></div>
                <div><span class="k">Total received (Polymarket):</span> <span class="v" id="pillPmCash">–</span></div>
                <div><span class="k">Total return:</span> <span class="v" id="pillReturn">–</span></div>
                <div><span class="k">Total return %:</span> <span class="v" id="pillReturnPct">–</span></div>
              </div>
            </div>
            <div class="small" id="teamLabel"></div>
          </div>

          <div class="results-grid" id="stats">
            <div class="stat"><div class="k">Required Polymarket NO shares (K)</div><div class="v" id="kOut">–</div></div>
            <div class="stat"><div class="k">Spend on NO (≈ K × q)</div><div class="v" id="noSpend">–</div></div>
            <div class="stat"><div class="k">Sportsbook stake (S)</div><div class="v" id="sOut">–</div></div>
            <div class="stat"><div class="k">Total outlay (S + NO spend)</div><div class="v" id="outlay">–</div></div>
            <div class="stat"><div class="k">Guaranteed profit (either outcome)</div><div class="v" id="profit">–</div></div>
            <div class="stat"><div class="k">ROI on outlay</div><div class="v" id="roi">–</div></div>
            <div class="stat"><div class="k">Breakeven decimal D<sub>min</sub></div><div class="v" id="dmin">–</div></div>
            <div class="stat"><div class="k">Odds edge (D − D<sub>min</sub>)</div><div class="v" id="edge">–</div></div>
          </div>

          <details>
            <summary>Outcome proof (should match)</summary>
            <div class="row two" style="margin-top:10px;">
              <div class="stat"><div class="k">Profit if team WINS</div><div class="v" id="pWin">–</div></div>
              <div class="stat"><div class="k">Profit if team LOSES</div><div class="v" id="pLose">–</div></div>
            </div>
          </details>

          <details>
            <summary>Normalized inputs</summary>
            <div class="row two" style="margin-top:10px;">
              <div class="stat"><div class="k">Decimal odds D</div><div class="v" id="DOut">–</div></div>
              <div class="stat"><div class="k">NO price q</div><div class="v" id="qOut">–</div></div>
              <div class="stat"><div class="k">YES price p ≈ 1 − q</div><div class="v" id="pOut">–</div></div>
              <div class="stat"><div class="k">Polymarket fee f</div><div class="v" id="fOut">–</div></div>
            </div>
          </details>

          <div class="footer">
            Always verify market rules & liquidity. This tool does not place bets.
          </div>
        </div>
      </section>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    function parseOdds(str) {
      if (!str) return NaN;
      str = String(str).trim().replace(',', '.');
      // Fractional (e.g., 7/1)
      if (str.includes('/')) {
        const [a, b] = str.split('/').map(Number);
        if (isFinite(a) && isFinite(b) && b !== 0) return 1 + (a / b);
      }
      // American (+700 or -150)
      if (/^[+-]?\d+$/.test(str)) {
        const a = parseInt(str, 10);
        if (a > 0) return 1 + a / 100;
        if (a < 0) return 1 - 100 / a; // a is negative
      }
      // Decimal
      const d = parseFloat(str);
      return isFinite(d) ? d : NaN;
    }

    function parsePercentOrDollar(valStr, unit) {
      if (!valStr) return NaN;
      let s = String(valStr).trim().replace(',', '.');
      // Allow trailing %
      if (s.endsWith('%')) { s = s.slice(0, -1); unit = 'percent'; }
      const x = parseFloat(s);
      if (!isFinite(x)) return NaN;
      if (unit === 'percent') return x / 100; // convert to 0..1
      return x; // already 0..1
    }

    function parseFee(valStr, unit) {
      if (!valStr) return NaN;
      let s = String(valStr).trim();
      if (s.endsWith('%')) { s = s.slice(0, -1); unit = 'percent'; }
      const x = parseFloat(s);
      if (!isFinite(x)) return NaN;
      return unit === 'percent' ? x / 100 : x;
    }

    function fmtMoney(x, sym) {
      if (!isFinite(x)) return '–';
      return `${sym}${x.toLocaleString(undefined,{ minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
    }
    function fmtNum(x, digits=2) {
      if (!isFinite(x)) return '–';
      return x.toLocaleString(undefined,{ minimumFractionDigits: digits, maximumFractionDigits: digits });
    }

    function updatePill(ok, msg) {
      const pill = $('arbPill');
      // Keep the content; only toggle styling based on arb viability
      pill.className = 'pill ' + (ok ? 'good' : 'bad');
    }

    function shareLink(params) {
      const url = new URL(window.location);
      Object.entries(params).forEach(([k,v]) => url.searchParams.set(k, v));
      navigator.clipboard.writeText(url.toString()).then(()=>{
        alert('Link copied to clipboard!');
      }, ()=>{
        prompt('Copy this link:', url.toString());
      });
    }

    function applyQueryParams() {
      const q = new URLSearchParams(window.location.search);
      if (q.has('team')) $('team').value = q.get('team');
      if (q.has('ccy')) $('ccy').value = q.get('ccy');
      if (q.has('odds')) $('odds').value = q.get('odds');
      if (q.has('stake')) $('stake').value = q.get('stake');
      if (q.has('stakeUnit')) $('stakeUnit').value = q.get('stakeUnit');
      if (q.has('pmPrice')) $('pmPrice').value = q.get('pmPrice');
      if (q.has('pmUnit')) $('pmUnit').value = q.get('pmUnit');
      if (q.has('fee')) $('fee').value = q.get('fee');
      if (q.has('feeUnit')) $('feeUnit').value = q.get('feeUnit');
      if (q.has('bankroll')) $('bankroll').value = q.get('bankroll');
      if (q.has('rounding')) $('rounding').value = q.get('rounding');
    }

    function compute() {
      const team = $('team').value.trim();
      $('teamLabel').textContent = team ? `Team: ${team}` : '';

      const ccy = $('ccy').value || '€';
      // Odds
      const D = parseOdds($('odds').value);
      // Stake
      let S = parseFloat($('stake').value);
      const stakeUnit = $('stakeUnit').value;
      const bankroll = parseFloat($('bankroll').value);
      if (stakeUnit === 'bankroll') {
        if (!isFinite(bankroll) || bankroll <= 0) { updatePill(false, 'Enter bankroll to use % stake'); return; }
        S = bankroll * (isFinite(S) ? S/100 : 0); // S was a percent
      }

      // Polymarket NO price q
      const qPrice = parsePercentOrDollar($('pmPrice').value, $('pmUnit').value);
      const f = parseFee($('fee').value, $('feeUnit').value);

      // Sanity checks
      if (!isFinite(D) || D <= 1) { updatePill(false, 'Enter valid sportsbook odds (>1.00)'); return; }
      if (!isFinite(S) || S <= 0) { updatePill(false, 'Enter a valid stake (>0)'); return; }
      if (!isFinite(qPrice) || qPrice <= 0 || qPrice >= 1) { updatePill(false, 'Enter NO price q in (0,1)'); return; }
      if (!isFinite(f) || f < 0 || f >= 1) { updatePill(false, 'Enter fee in [0,1)'); return; }

      const qNO = qPrice;
      const pYES = 1 - qNO; // informational

      // Threshold odds for arb
      const Dmin = (1 - f + f*qNO) / ((1 - qNO) * (1 - f));
      const edge = D - Dmin;

      // Sizing
      let K = (S * D) / (1 - f + f*qNO); // required NO shares to equalize profit

      // Rounding (optional)
      const rounding = $('rounding').value;
      let noSpend = K * qNO; // spend in $ on Polymarket
      if (rounding === 'cent') {
        noSpend = Math.round(noSpend * 100) / 100; // round spend to cents
        K = noSpend / qNO;
      } else if (rounding === 'share') {
        K = Math.round(K * 100) / 100; // shares to 0.01
        noSpend = K * qNO;
      }

      // Profits
      const profitWin = S * (D - 1) - noSpend; // team wins: sportsbook pays, NO goes to 0 (we spent noSpend)
      const profitLose = -S + K * (1 - qNO) * (1 - f); // team loses: sportsbook loses stake, NO pays 1 minus fee on winnings

      const profit = Math.min(profitWin, profitLose); // should be ~equal; use min to be conservative
      const outlay = S + noSpend;
      const roi = profit / outlay;

      // Update UI
      $('DOut').textContent = fmtNum(D, 4);
      $('qOut').textContent = fmtNum(qNO, 4);
      $('pOut').textContent = fmtNum(pYES, 4);
      $('fOut').textContent = fmtNum(f, 4);

      $('kOut').textContent = fmtNum(K, 4) + ' shares';
      $('noSpend').textContent = fmtMoney(noSpend, ccy);
      $('sOut').textContent = fmtMoney(S, ccy);
      $('outlay').textContent = fmtMoney(outlay, ccy);
      $('profit').textContent = fmtMoney(profit, ccy);
      $('roi').textContent = isFinite(roi) ? (roi*100).toFixed(2) + '%' : '–';
      $('dmin').textContent = fmtNum(Dmin, 4);
      $('edge').textContent = (edge >= 0 ? '+' : '') + fmtNum(edge, 4);

      $('pWin').textContent = fmtMoney(profitWin, ccy);
      $('pLose').textContent = fmtMoney(profitLose, ccy);
      // Update Arb Status quick view
      $('pillUniBet').textContent = fmtMoney(S, ccy);
      $('pillPmCash').textContent = fmtMoney(-noSpend, ccy);
      $('pillReturn').textContent = fmtMoney(profit, ccy);
      $('pillReturnPct').textContent = isFinite(roi) ? (roi*100).toFixed(2) + '%' : '–';

      const isArb = profit > 0 && D > Dmin;
      updatePill(isArb, isArb ? 'ARB: guaranteed positive' : 'No arb at these inputs');
    }

    $('calcBtn').addEventListener('click', compute);
    $('resetBtn').addEventListener('click', () => { window.location.search = ''; window.location.reload(); });
    $('shareBtn').addEventListener('click', () => {
      const params = {
        team: $('team').value,
        ccy: $('ccy').value,
        odds: $('odds').value,
        stake: $('stake').value,
        stakeUnit: $('stakeUnit').value,
        pmPrice: $('pmPrice').value,
        pmUnit: $('pmUnit').value,
        fee: $('fee').value,
        feeUnit: $('feeUnit').value,
        bankroll: $('bankroll').value,
        rounding: $('rounding').value,
      };
      shareLink(params);
    });

    // Auto-compute on Enter in inputs
    ['team','ccy','odds','stake','pmPrice','fee','bankroll'].forEach(id => {
      $(id).addEventListener('keydown', (e)=>{ if (e.key === 'Enter') compute(); });
    });

    applyQueryParams();
  </script>
</body>
</html>
