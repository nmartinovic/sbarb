<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Unibet × Polymarket Arb Calculator — v2</title>
  <meta name="description" content="Calculate sportsbook-YES × Polymarket hedge using either Buy NO or Sell YES, with optional fees. Shows size, collateral, cashflow and guaranteed profit." />
  <style>
    :root { --bg:#0b0e13; --card:#121826; --muted:#8aa0b2; --text:#e6edf3; --accent:#4cc38a; --border:#223146; --radius:16px; --gap:14px; --shadow:0 6px 24px rgba(0,0,0,.35),0 2px 8px rgba(0,0,0,.2);} *{box-sizing:border-box}
    html,body{height:100%} body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:radial-gradient(1200px 800px at 20% -20%,#162235 0%,transparent 60%),radial-gradient(1000px 600px at 110% 0%,#0d1b2a 0%,transparent 60%),var(--bg);color:var(--text);line-height:1.35}
    .container{max-width:1100px;margin:32px auto;padding:0 16px} header{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:18px} h1{font-size:22px;margin:0;letter-spacing:.2px} .small{color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:var(--gap)} .card{grid-column:span 12;background:linear-gradient(180deg,rgba(255,255,255,.02),transparent 60%),var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)} .card .inner{padding:18px}
    @media(min-width:900px){.card.inputs{grid-column:span 7}.card.results{grid-column:span 5}}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px} input[type=text],input[type=number],select{width:100%;background:#0f1724;color:var(--text);border:1px solid var(--border);border-radius:12px;padding:12px;outline:none} input::placeholder{color:#6e8193}
    .row{display:grid;grid-template-columns:1fr;gap:var(--gap)} @media(min-width:700px){.row.two{grid-template-columns:1fr 1fr}} @media(min-width:900px){.row.three{grid-template-columns:1fr 1fr 1fr}}
    .inline{display:grid;grid-template-columns:2fr 1fr;gap:10px} .note{font-size:12px;color:var(--muted);margin-top:6px}
    .btns{display:flex;gap:10px;flex-wrap:wrap} button{background:#0f1724;color:var(--text);border:1px solid var(--border);border-radius:12px;padding:10px 14px;cursor:pointer;transition:transform .02s,border-color .15s} button:hover{border-color:#38567a} button:active{transform:translateY(1px)} .btn-primary{background:linear-gradient(180deg,rgba(76,195,138,.18),rgba(76,195,138,.06));border-color:#2a7f5c}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:#0f1724;font-size:12px;color:var(--muted)} .pill.good{color:#b7f6d5;border-color:#2a7f5c;background:rgba(76,195,138,.08)} .pill.bad{color:#ffd7d9;border-color:#7a2a2a;background:rgba(242,85,90,.08)}
    .stat{background:#0f1724;border:1px solid var(--border);border-radius:12px;padding:12px;display:grid;gap:8px} .stat .k{font-size:12px;color:var(--muted)} .stat .v{font-size:18px;font-weight:600}
    .results-grid{display:grid;grid-template-columns:1fr;gap:var(--gap)} @media(min-width:700px){.results-grid{grid-template-columns:1fr 1fr}}
    details{border-top:1px dashed var(--border);padding-top:12px;margin-top:12px} summary{cursor:pointer;color:var(--muted)} code{background:#0f1724;border:1px solid var(--border);padding:2px 6px;border-radius:6px}
    .footer{margin-top:16px;color:var(--muted);font-size:12px} a{color:#8dd9ff;text-decoration:none}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Unibet × Polymarket Arb Calculator — v2</h1>
      <div class="small">YES at Sportsbook + (Buy NO / Sell YES) on Polymarket</div>
    </header>

    <div class="grid">
      <section class="card inputs">
        <div class="inner">
          <div class="row two">
            <div>
              <label>Team (optional)</label>
              <input id="team" type="text" placeholder="Bills / Ravens / etc" />
            </div>
            <div>
              <label>Currency symbol</label>
              <input id="ccy" type="text" value="€" maxlength="3" />
            </div>
          </div>

          <div class="row two" style="margin-top:10px;">
            <div>
              <label>Unibet odds (decimal/+American/fractional)</label>
              <input id="odds" type="text" placeholder="8.0 or +700 or 7/1" />
              <div class="note">Unibet FR uses decimal (e.g., <code>8.0</code>).</div>
            </div>
            <div>
              <label>Stake at sportsbook</label>
              <div class="inline">
                <input id="stake" type="number" step="0.01" value="100" />
                <select id="stakeUnit">
                  <option value="abs" selected>Absolute</option>
                  <option value="bankroll">% of bankroll</option>
                </select>
              </div>
              <div class="note">If "% of bankroll" is chosen, set bankroll below.</div>
            </div>
          </div>

          <div class="row two" style="margin-top:10px;">
            <div>
              <label>Polymarket leg & price</label>
              <div class="inline" style="grid-template-columns: 1.2fr 0.8fr;">
                <select id="pmMode">
                  <option value="buyNO" selected>Buy NO (enter q)</option>
                  <option value="sellYES">Sell YES (enter p)</option>
                </select>
                <select id="pmUnit">
                  <option value="dollar" selected>price 0–1</option>
                  <option value="percent">percent 0–100</option>
                </select>
              </div>
              <input id="pmPrice" type="text" placeholder="NO: 0.87 (or YES: 0.13)" style="margin-top:8px;" />
              <div class="note"><b>Buy NO</b> spends q now. <b>Sell YES</b> receives p now and locks collateral ≈ (1−p) per share. Either way, exposure is ~identical when p+q≈1.</div>
            </div>
            <div>
              <label>Polymarket fee</label>
              <div class="inline">
                <input id="fee" type="text" value="0%" />
                <select id="feeUnit">
                  <option value="percent" selected>%</option>
                  <option value="decimal">decimal</option>
                </select>
              </div>
              <div class="note">Official docs say no trading fee; some sources cite ~2% on net winnings at settlement. Set what you observe.</div>
            </div>
          </div>

          <div class="row two" style="margin-top:10px;">
            <div>
              <label>Optional: Bankroll (for % stake)</label>
              <input id="bankroll" type="number" step="0.01" placeholder="e.g., 5000" />
            </div>
            <div>
              <label>Rounding</label>
              <select id="rounding">
                <option value="none">None (full precision)</option>
                <option value="cent">Round spends to cents</option>
                <option value="share">Round NO shares to 0.01</option>
              </select>
            </div>
          </div>

          <div class="btns" style="margin-top:14px;">
            <button class="btn-primary" id="calcBtn">Calculate</button>
            <button class="btn-ghost" id="resetBtn">Reset</button>
            <button class="btn-ghost" id="shareBtn">Share pre-filled link</button>
          </div>

          <details style="margin-top:10px;">
            <summary>How this works (math)</summary>
            <div class="note" style="margin-top:8px;">
              You back <b>YES</b> at the sportsbook (stake S at decimal D) and hedge on Polymarket either by <b>buying NO</b> at price q or <b>selling YES</b> at price p. Under Polymarket’s fully-collateralized design (1 YES + 1 NO = $1), these are economically equivalent when p + q ≈ 1.
              <ul>
                <li><b>Buy NO</b> (price q): profit if team loses = (1−q)(1−f); loss if team wins = −q.</li>
                <li><b>Sell YES</b> (price p): profit if team loses ≈ p(1−f); loss if team wins ≈ −(1−p). Cash now: +p/share; collateral locked: (1−p)/share.</li>
                <li>Size to equalize outcomes (either mode): <code>K = S·D / (1 − f + f·q)</code>, with <code>q = 1 − p</code> when using a YES price.</li>
                <li>Breakeven sportsbook odds for risk‑free: <code>D<sub>min</sub> = (1 − f + f·q) / ((1 − q)·(1 − f))</code>.</li>
              </ul>
            </div>
          </details>
        </div>
      </section>

      <section class="card results">
        <div class="inner">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px;">
            <div>
              <div class="small">Arb status</div>
              <div id="arbPill" class="pill">Enter inputs…</div>
            </div>
            <div class="small" id="teamLabel"></div>
          </div>

          <div class="results-grid" id="stats">
            <div class="stat"><div class="k">Required Polymarket size (K shares)</div><div class="v" id="kOut">–</div></div>
            <div class="stat"><div class="k" id="polyCashLabel">Polymarket cash now</div><div class="v" id="noSpend">–</div></div>
            <div class="stat"><div class="k" id="polyCollatLabel">Polymarket collateral locked</div><div class="v" id="polyCollat">–</div></div>
            <div class="stat"><div class="k">Sportsbook stake (S)</div><div class="v" id="sOut">–</div></div>
            <div class="stat"><div class="k">Total capital tied (S + collateral)</div><div class="v" id="outlay">–</div></div>
            <div class="stat"><div class="k">Guaranteed profit (either outcome)</div><div class="v" id="profit">–</div></div>
            <div class="stat"><div class="k">ROI on capital tied</div><div class="v" id="roi">–</div></div>
            <div class="stat"><div class="k">Breakeven decimal D<sub>min</sub></div><div class="v" id="dmin">–</div></div>
            <div class="stat"><div class="k">Odds edge (D − D<sub>min</sub>)</div><div class="v" id="edge">–</div></div>
          </div>

          <details>
            <summary>Outcome proof (should match)</summary>
            <div class="row two" style="margin-top:10px;">
              <div class="stat"><div class="k">Profit if team WINS</div><div class="v" id="pWin">–</div></div>
              <div class="stat"><div class="k">Profit if team LOSES</div><div class="v" id="pLose">–</div></div>
            </div>
          </details>

          <details>
            <summary>Normalized inputs</summary>
            <div class="row two" style="margin-top:10px;">
              <div class="stat"><div class="k">Decimal odds D</div><div class="v" id="DOut">–</div></div>
              <div class="stat"><div class="k">NO price q</div><div class="v" id="qOut">–</div></div>
              <div class="stat"><div class="k">YES price p ≈ 1 − q</div><div class="v" id="pOut">–</div></div>
              <div class="stat"><div class="k">Polymarket fee f</div><div class="v" id="fOut">–</div></div>
            </div>
          </details>

          <div class="footer">Always verify market rules & liquidity. This tool does not place bets.</div>
        </div>
      </section>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    function parseOdds(str){ if(!str) return NaN; str=String(str).trim().replace(',', '.'); if(str.includes('/')){const[a,b]=str.split('/').map(Number); if(isFinite(a)&&isFinite(b)&&b!==0) return 1+(a/b);} if(/^[+-]?\d+$/.test(str)){const a=parseInt(str,10); if(a>0) return 1+a/100; if(a<0) return 1-100/a;} const d=parseFloat(str); return isFinite(d)?d:NaN; }
    function parsePercentOrDollar(valStr,unit){ if(!valStr) return NaN; let s=String(valStr).trim().replace(',', '.'); if(s.endsWith('%')){ s=s.slice(0,-1); unit='percent'; } const x=parseFloat(s); if(!isFinite(x)) return NaN; return unit==='percent'? x/100 : x; }
    function parseFee(valStr,unit){ if(!valStr) return NaN; let s=String(valStr).trim(); if(s.endsWith('%')){ s=s.slice(0,-1); unit='percent'; } const x=parseFloat(s); if(!isFinite(x)) return NaN; return unit==='percent'? x/100 : x; }
    function fmtMoney(x,sym){ if(!isFinite(x)) return '–'; return `${sym}${x.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}`; }
    function fmtNum(x,d=2){ if(!isFinite(x)) return '–'; return x.toLocaleString(undefined,{minimumFractionDigits:d,maximumFractionDigits:d}); }
    function updatePill(ok,msg){ const pill=$('arbPill'); pill.textContent=msg; pill.className='pill '+(ok?'good':'bad'); }
    function shareLink(params){ const url=new URL(window.location); Object.entries(params).forEach(([k,v])=>url.searchParams.set(k,v)); navigator.clipboard.writeText(url.toString()).then(()=>{ alert('Link copied to clipboard!'); },()=>{ prompt('Copy this link:', url.toString()); }); }
    function applyQueryParams(){ const q=new URLSearchParams(window.location.search); ['team','ccy','odds','stake','stakeUnit','pmPrice','pmUnit','pmMode','fee','feeUnit','bankroll','rounding'].forEach(k=>{ if(q.has(k)) $(k).value=q.get(k); }); }

    function compute(){
      const team=$('team').value.trim(); $('teamLabel').textContent=team?`Team: ${team}`:'';
      const ccy=$('ccy').value||'€';
      const D=parseOdds($('odds').value);
      let S=parseFloat($('stake').value);
      const stakeUnit=$('stakeUnit').value; const bankroll=parseFloat($('bankroll').value);
      if(stakeUnit==='bankroll'){ if(!isFinite(bankroll)||bankroll<=0){ updatePill(false,'Enter bankroll to use % stake'); return; } S=bankroll*(isFinite(S)?S/100:0); }

      const pmMode=$('pmMode').value; const unit=$('pmUnit').value; const raw=$('pmPrice').value; const f=parseFee($('fee').value,$('feeUnit').value);
      if(!isFinite(D)||D<=1){ updatePill(false,'Enter valid sportsbook odds (>1.00)'); return; }
      if(!isFinite(S)||S<=0){ updatePill(false,'Enter a valid stake (>0)'); return; }
      if(!isFinite(f)||f<0||f>=1){ updatePill(false,'Enter fee in [0,1)'); return; }

      let price=parsePercentOrDollar(raw,unit); if(!isFinite(price)){ updatePill(false,'Enter a valid Polymarket price'); return; }
      let qNO,pYES; if(pmMode==='sellYES'){ pYES=price; if(pYES<=0||pYES>=1){ updatePill(false,'Enter YES price p in (0,1)'); return; } qNO=1-pYES; } else { qNO=price; if(qNO<=0||qNO>=1){ updatePill(false,'Enter NO price q in (0,1)'); return; } pYES=1-qNO; }

      const Dmin=(1 - f + f*qNO) / ((1 - qNO) * (1 - f));
      const edge=D - Dmin;
      let K=(S * D) / (1 - f + f*qNO);

      const rounding=$('rounding').value; let noSpend=K*qNO; if(rounding==='cent'){ noSpend=Math.round(noSpend*100)/100; K=noSpend/qNO; } else if(rounding==='share'){ K=Math.round(K*100)/100; noSpend=K*qNO; }

      const profitWin= S*(D-1) - noSpend; // team wins: sportsbook pays, NO side loses q or short YES loses (1-p)
      const profitLose= -S + K*(1 - qNO)*(1 - f); // team loses: sportsbook loses, PM leg pays p (or 1-q) after fee
      const profit=Math.min(profitWin,profitLose);

      // Display
      $('DOut').textContent=fmtNum(D,4); $('qOut').textContent=fmtNum(qNO,4); $('pOut').textContent=fmtNum(pYES,4); $('fOut').textContent=fmtNum(f,4);
      $('kOut').textContent=fmtNum(K,4)+' shares';
      let cashNow,collat; if(pmMode==='sellYES'){ cashNow=K*pYES; collat=K*(1-pYES); $('polyCashLabel').textContent='Cash received now (p × K)'; $('polyCollatLabel').textContent='Collateral locked ((1−p) × K)'; } else { cashNow=-noSpend; collat=K*qNO; $('polyCashLabel').textContent='Cash spent now (q × K)'; $('polyCollatLabel').textContent='Economic collateral (≈ q × K)'; }
      $('noSpend').textContent=fmtMoney(cashNow, ccy);
      $('polyCollat').textContent=fmtMoney(collat, ccy);
      $('sOut').textContent=fmtMoney(S, ccy);
      $('outlay').textContent=fmtMoney(S + collat, ccy);
      const outlay=S + collat; const roi=profit / outlay; $('profit').textContent=fmtMoney(profit, ccy); $('roi').textContent=isFinite(roi)? (roi*100).toFixed(2)+'%' : '–'; $('dmin').textContent=fmtNum(Dmin,4); $('edge').textContent=(edge>=0?'+':'')+fmtNum(edge,4);
      $('pWin').textContent=fmtMoney(profitWin, ccy); $('pLose').textContent=fmtMoney(profitLose, ccy);

      const isArb=profit>0 && D>Dmin; updatePill(isArb, isArb? 'ARB: guaranteed positive' : 'No arb at these inputs');
    }

    $('calcBtn').addEventListener('click', compute);
    $('resetBtn').addEventListener('click', ()=>{ window.location.search=''; window.location.reload(); });
    $('shareBtn').addEventListener('click', ()=>{ const params={ team:$('team').value, ccy:$('ccy').value, odds:$('odds').value, stake:$('stake').value, stakeUnit:$('stakeUnit').value, pmMode:$('pmMode').value, pmPrice:$('pmPrice').value, pmUnit:$('pmUnit').value, fee:$('fee').value, feeUnit:$('feeUnit').value, bankroll:$('bankroll').value, rounding:$('rounding').value, }; shareLink(params); });
    ;['team','ccy','odds','stake','pmPrice','fee','bankroll'].forEach(id=>{ $(id).addEventListener('keydown',e=>{ if(e.key==='Enter') compute(); }); });
    applyQueryParams();
  </script>
</body>
</html>
